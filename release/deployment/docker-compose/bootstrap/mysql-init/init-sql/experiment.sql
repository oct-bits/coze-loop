CREATE TABLE IF NOT EXISTS `experiment`
(
    `id`                  bigint unsigned                                                NOT NULL COMMENT 'id',
    `space_id`            bigint unsigned                                                NOT NULL DEFAULT '0' COMMENT '空间 id',
    `created_by`          varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci  NOT NULL DEFAULT '' COMMENT '创建者 id',
    `name`                varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci  NOT NULL DEFAULT '' COMMENT '实验名称',
    `description`         varchar(1024) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci NOT NULL DEFAULT '' COMMENT '实验描述',
    `eval_set_version_id` bigint unsigned                                                NOT NULL DEFAULT '0' COMMENT '评测集版本 id',
    `target_type`         bigint unsigned                                                NOT NULL DEFAULT '0' COMMENT '评估对象类型',
    `target_version_id`   bigint unsigned                                                NOT NULL DEFAULT '0' COMMENT '评估对象版本 id',
    `eval_conf`           blob COMMENT '实验评估流程配置',
    `status`              int unsigned                                                   NOT NULL DEFAULT '0' COMMENT '状态',
    `status_message`      blob COMMENT '状态提示信息',
    `start_at`            timestamp                                                      NULL     DEFAULT NULL COMMENT '开始执行时间',
    `end_at`              timestamp                                                      NULL     DEFAULT NULL COMMENT '结束执行时间',
    `created_at`          timestamp                                                      NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '创建时间',
    `updated_at`          timestamp                                                      NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '更新时间',
    `deleted_at`          timestamp                                                      NULL     DEFAULT NULL COMMENT '删除时间',
    `latest_run_id`       bigint unsigned                                                NOT NULL DEFAULT '0' COMMENT '最后运行id',
    `target_id`           bigint unsigned                                                NOT NULL DEFAULT '0' COMMENT '评估对象 id',
    `eval_set_id`         bigint unsigned                                                NOT NULL DEFAULT '0' COMMENT '评测集 id',
    `credit_cost`         int                                                            NOT NULL DEFAULT '0' COMMENT '权益消耗模式',
    `source_type`         int unsigned                                                   NOT NULL DEFAULT '1' COMMENT '实验来源类型，评测:1,自动化任务:2...',
    `source_id`           varchar(128) CHARACTER SET utf8mb4 COLLATE utf8mb4_general_ci  NOT NULL DEFAULT '0' COMMENT '实验来源id',
    `expt_type`           int unsigned                                                   NOT NULL DEFAULT '1' COMMENT '实验类型，offline:1,online:2...',
    `max_alive_time`      bigint unsigned                                                         DEFAULT NULL COMMENT '最大存活时间',
    PRIMARY KEY (`id`),
    UNIQUE KEY `uk_expt_item_idx` (`space_id`, `name`, `deleted_at`),
    KEY `idx_space_deleted_created_by` (`space_id`, `created_by`, `deleted_at`),
    KEY `idx_space_deleted_status` (`space_id`, `status`, `deleted_at`),
    KEY `idx_deleted_dataset` (`space_id`, `eval_set_version_id`, `deleted_at`),
    KEY `idx_deleted_target_type` (`space_id`, `target_type`, `deleted_at`),
    KEY `idx_target_id_delete_at` (`space_id`, `target_id`, `deleted_at`),
    KEY `idx_eval_set_id_delete_at` (`space_id`, `eval_set_id`, `deleted_at`),
    KEY `idx_space_start_at` (`space_id`, `start_at`),
    KEY `idx_space_end_at` (`space_id`, `end_at`),
    KEY `idx_source_type_source_id` (`source_type`, `source_id`)
) ENGINE = InnoDB
  DEFAULT CHARSET = utf8mb4
  COLLATE = utf8mb4_general_ci COMMENT ='experiment';